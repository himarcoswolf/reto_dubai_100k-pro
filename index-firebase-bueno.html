<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Reto Dubai 100K - Live Tracking</title>
    <meta name="description" content="Sigue en tiempo real mi reto de 100K en Dubai">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.4); }
            50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.8); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bob {
            0%, 100% { transform: translateY(0px); }
            25% { transform: translateY(-3px); }
            50% { transform: translateY(-5px); }
            75% { transform: translateY(-3px); }
        }
        
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-bob { animation: bob 2s ease-in-out infinite; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.5); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(6, 182, 212, 0.7); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Configuration - USA TU PROPIA CONFIG (te la doy al final)
        const firebaseConfig = {
            apiKey: "AIzaSyB5KzKa0pKslPn6cJrZUAxZ3gXTF_GWazE",
  authDomain: "reto-dubai-100k-10k.firebaseapp.com",
  projectId: "reto-dubai-100k-10k",
  storageBucket: "reto-dubai-100k-10k.firebasestorage.app",
  messagingSenderId: "460196197011",
  appId: "1:460196197011:web:aae62f87d6352351e41366",
  measurementId: "G-2J8SDF1EZJ"
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        const START_DATE = new Date('2025-11-01T00:00:00+04:00');
        const GOAL = 100000;
        const INITIAL_BUDGET = 10000;
        const ADMIN_PASSWORD = 'Dubai2025!';

        const LOCATIONS = {
            oficina: { id: 'oficina', name: 'üè¢ Oficina', icon: 'üè¢', color: 'from-blue-500 to-cyan-500', defaultActivity: 'Trabajando en mi escritorio' },
            gimnasio: { id: 'gimnasio', name: 'üí™ Gimnasio', icon: 'üí™', color: 'from-orange-500 to-red-500', defaultActivity: 'Entrenamiento' },
            casa: { id: 'casa', name: 'üè† Casa', icon: 'üè†', color: 'from-purple-500 to-pink-500', defaultActivity: 'Descansando' },
            reunion: { id: 'reunion', name: 'ü§ù Reuni√≥n', icon: 'ü§ù', color: 'from-green-500 to-emerald-500', defaultActivity: 'Reuni√≥n con cliente' },
            mall: { id: 'mall', name: 'üèôÔ∏è Dubai Mall', icon: 'üèôÔ∏è', color: 'from-yellow-500 to-orange-500', defaultActivity: 'Networking' },
            aeropuerto: { id: 'aeropuerto', name: '‚úàÔ∏è Aeropuerto', icon: '‚úàÔ∏è', color: 'from-sky-500 to-blue-500', defaultActivity: 'Viajando' },
            restaurante: { id: 'restaurante', name: 'üçΩÔ∏è Restaurante', icon: 'üçΩÔ∏è', color: 'from-amber-500 to-orange-500', defaultActivity: 'Comida de negocios' }
        };

        // Componentes de escenas SVG (simplificado para espacio)
        const OficinaScene = () => (
            <svg viewBox="0 0 400 300" className="w-full h-auto max-w-2xl mx-auto">
                <polygon points="200,250 100,200 200,150 300,200" fill="#3b4252" stroke="#4c566a" strokeWidth="2"/>
                <polygon points="180,180 220,180 230,190 170,190" fill="#5e81ac" stroke="#4c566a" strokeWidth="1.5"/>
                <polygon points="170,190 230,190 230,200 170,200" fill="#81a1c1" stroke="#4c566a" strokeWidth="1.5"/>
                <rect x="190" y="165" width="20" height="15" fill="#2e3440" stroke="#4c566a" strokeWidth="1"/>
                <rect x="192" y="167" width="16" height="11" fill="#06b6d4"/>
                <circle cx="200" cy="195" r="8" fill="#f97316" className="animate-bob"/>
                <ellipse cx="200" cy="205" rx="10" ry="5" fill="#3b82f6" className="animate-bob"/>
            </svg>
        );

        const GimnasioScene = () => (
            <svg viewBox="0 0 400 300" className="w-full h-auto max-w-2xl mx-auto">
                <polygon points="200,250 100,200 200,150 300,200" fill="#3b4252" stroke="#4c566a" strokeWidth="2"/>
                <circle cx="200" cy="182" r="9" fill="#f97316" className="animate-bob"/>
                <ellipse cx="200" cy="193" rx="11" ry="6" fill="#3b82f6" className="animate-bob"/>
            </svg>
        );

        const CasaScene = ({sleeping}) => (
            <svg viewBox="0 0 400 300" className="w-full h-auto max-w-2xl mx-auto">
                <polygon points="200,250 100,200 200,150 300,200" fill="#3b4252" stroke="#4c566a" strokeWidth="2"/>
                <polygon points="160,190 240,190 250,200 150,200" fill="#5e81ac" stroke="#4c566a" strokeWidth="1.5"/>
                {sleeping ? (
                    <text x="200" y="192" fontSize="12" fill="#ebcb8b">üí§</text>
                ) : (
                    <circle cx="190" cy="190" r="8" fill="#f97316"/>
                )}
            </svg>
        );

        const ReunionScene = () => <OficinaScene />;
        const MallScene = () => <GimnasioScene />;
        const AeropuertoScene = () => <CasaScene sleeping={false} />;
        const RestauranteScene = () => <OficinaScene />;

        const SimsApp = () => {
            const [data, setData] = useState({
                totalIngresos: 0,
                totalGastos: 0,
                ingresosPorCategoria: { asesoria: 0, realEstate: 0, inversiones: 0 },
                actualizaciones: [],
                mensajes: [],
                currentLocation: 'casa',
                currentActivity: 'Prepar√°ndome para el d√≠a',
                locationChangedAt: new Date().toISOString(),
                isAutoSleeping: false
            });

            const [visitantes, setVisitantes] = useState(0);
            const [showAdmin, setShowAdmin] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [showLogrosDetail, setShowLogrosDetail] = useState(false);
            const [newMessage, setNewMessage] = useState('');
            const [editingMovement, setEditingMovement] = useState(null);
            
            const [activityForm, setActivityForm] = useState({ location: 'oficina', activity: '' });
            const [financeForm, setFinanceForm] = useState({ categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: '' });

            // Escuchar cambios en Firebase en tiempo real
            useEffect(() => {
                const dataRef = database.ref('retoData');
                dataRef.on('value', (snapshot) => {
                    const firebaseData = snapshot.val();
                    if (firebaseData) {
                        setData(firebaseData);
                    }
                });

                // Contador de visitantes
                const visitantesRef = database.ref('visitantes');
                visitantesRef.transaction((current) => {
                    return (current || 0) + 1;
                });
                visitantesRef.on('value', (snapshot) => {
                    setVisitantes(snapshot.val() || 0);
                });

                return () => {
                    dataRef.off();
                    visitantesRef.off();
                };
            }, []);

            // Sistema autom√°tico de sue√±o
            useEffect(() => {
                const checkAutoSchedule = () => {
                    const now = new Date();
                    const dubaiTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Dubai' }));
                    const hour = dubaiTime.getHours();

                    if (hour >= 23 || hour < 7) {
                        if (!data.isAutoSleeping) {
                            updateData({
                                currentLocation: 'casa',
                                currentActivity: 'üò¥ Durmiendo',
                                locationChangedAt: new Date().toISOString(),
                                isAutoSleeping: true
                            });
                        }
                    } else if (hour === 7 && data.isAutoSleeping) {
                        updateData({
                            currentLocation: 'casa',
                            currentActivity: '‚òÄÔ∏è Buenos d√≠as!',
                            locationChangedAt: new Date().toISOString(),
                            isAutoSleeping: false
                        });
                    }
                };

                checkAutoSchedule();
                const interval = setInterval(checkAutoSchedule, 60000);
                return () => clearInterval(interval);
            }, [data.isAutoSleeping]);

            // Actualizar datos en Firebase
            const updateData = (updates) => {
                const newData = { ...data, ...updates };
                database.ref('retoData').set(newData);
            };

            // Calcular logros din√°micamente
            const logrosActuales = [];
            if (data.totalIngresos >= 25000) logrosActuales.push('25k');
            if (data.totalIngresos >= 50000) logrosActuales.push('50k');
            if (data.totalIngresos >= 75000) logrosActuales.push('75k');

            const getTimeInLocation = () => {
                const now = new Date();
                const changedAt = new Date(data.locationChangedAt);
                const diffMs = now - changedAt;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const remainingMins = diffMins % 60;
                if (diffHours > 0) return `${diffHours}h ${remainingMins}m`;
                return `${diffMins}m`;
            };

            const getDaysElapsed = () => {
                const now = new Date();
                const diff = now - START_DATE;
                return Math.floor(diff / (1000 * 60 * 60 * 24));
            };

            const progreso = (data.totalIngresos / GOAL) * 100;
            const budgetRestante = INITIAL_BUDGET - data.totalGastos;
            const progressoBudget = (budgetRestante / INITIAL_BUDGET) * 100;

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAuthenticated(true);
                } else {
                    alert('Contrase√±a incorrecta');
                }
            };

            const handleActivityUpdate = (e) => {
                e.preventDefault();
                const location = LOCATIONS[activityForm.location];
                const activity = activityForm.activity.trim() || location.defaultActivity;

                updateData({
                    currentLocation: activityForm.location,
                    currentActivity: activity,
                    locationChangedAt: new Date().toISOString(),
                    isAutoSleeping: false
                });

                setActivityForm({ location: 'oficina', activity: '' });
                alert('¬°Ubicaci√≥n actualizada!');
            };

            const handleFinanceUpdate = (e) => {
                e.preventDefault();
                const monto = parseFloat(financeForm.monto);
                
                if (isNaN(monto) || monto <= 0) {
                    alert('Introduce un monto v√°lido');
                    return;
                }

                const nuevaActualizacion = {
                    id: Date.now(),
                    fecha: new Date().toISOString(),
                    categoria: financeForm.categoria,
                    monto: monto,
                    tipo: financeForm.tipo,
                    nota: financeForm.nota
                };

                let nuevoTotalIngresos = data.totalIngresos;
                let nuevoTotalGastos = data.totalGastos;
                let nuevosIngresosPorCategoria = { ...data.ingresosPorCategoria };
                
                if (financeForm.tipo === 'ingreso') {
                    nuevoTotalIngresos += monto;
                    nuevosIngresosPorCategoria[financeForm.categoria] += monto;
                } else {
                    nuevoTotalGastos += monto;
                }

                updateData({
                    totalIngresos: nuevoTotalIngresos,
                    totalGastos: nuevoTotalGastos,
                    ingresosPorCategoria: nuevosIngresosPorCategoria,
                    actualizaciones: [nuevaActualizacion, ...data.actualizaciones]
                });

                setFinanceForm({ categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: '' });
                alert('¬°Actualizaci√≥n guardada!');
            };

            const handleDeleteMovement = (movementId) => {
                if (!confirm('¬øSeguro que quieres eliminar este movimiento?')) return;

                const movement = data.actualizaciones.find(a => a.id === movementId);
                if (!movement) return;

                let nuevoTotalIngresos = data.totalIngresos;
                let nuevoTotalGastos = data.totalGastos;
                let nuevosIngresosPorCategoria = { ...data.ingresosPorCategoria };

                if (movement.tipo === 'ingreso') {
                    nuevoTotalIngresos -= movement.monto;
                    nuevosIngresosPorCategoria[movement.categoria] -= movement.monto;
                } else {
                    nuevoTotalGastos -= movement.monto;
                }

                updateData({
                    totalIngresos: nuevoTotalIngresos,
                    totalGastos: nuevoTotalGastos,
                    ingresosPorCategoria: nuevosIngresosPorCategoria,
                    actualizaciones: data.actualizaciones.filter(a => a.id !== movementId)
                });

                alert('Movimiento eliminado');
            };

            const handleEditMovement = (movement) => {
                setEditingMovement(movement);
                setFinanceForm({
                    categoria: movement.categoria || 'asesoria',
                    monto: movement.monto.toString(),
                    tipo: movement.tipo,
                    nota: movement.nota || ''
                });
            };

            const handleSaveEdit = (e) => {
                e.preventDefault();
                if (!editingMovement) return;

                const nuevoMonto = parseFloat(financeForm.monto);
                if (isNaN(nuevoMonto) || nuevoMonto <= 0) {
                    alert('Introduce un monto v√°lido');
                    return;
                }

                // Revertir el movimiento antiguo
                let nuevoTotalIngresos = data.totalIngresos;
                let nuevoTotalGastos = data.totalGastos;
                let nuevosIngresosPorCategoria = { ...data.ingresosPorCategoria };

                if (editingMovement.tipo === 'ingreso') {
                    nuevoTotalIngresos -= editingMovement.monto;
                    nuevosIngresosPorCategoria[editingMovement.categoria] -= editingMovement.monto;
                } else {
                    nuevoTotalGastos -= editingMovement.monto;
                }

                // Aplicar el nuevo movimiento
                if (financeForm.tipo === 'ingreso') {
                    nuevoTotalIngresos += nuevoMonto;
                    nuevosIngresosPorCategoria[financeForm.categoria] += nuevoMonto;
                } else {
                    nuevoTotalGastos += nuevoMonto;
                }

                // Actualizar el movimiento
                const actualizacionesActualizadas = data.actualizaciones.map(a => 
                    a.id === editingMovement.id ? {
                        ...a,
                        monto: nuevoMonto,
                        categoria: financeForm.categoria,
                        tipo: financeForm.tipo,
                        nota: financeForm.nota
                    } : a
                );

                updateData({
                    totalIngresos: nuevoTotalIngresos,
                    totalGastos: nuevoTotalGastos,
                    ingresosPorCategoria: nuevosIngresosPorCategoria,
                    actualizaciones: actualizacionesActualizadas
                });

                setEditingMovement(null);
                setFinanceForm({ categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: '' });
                alert('¬°Movimiento actualizado!');
            };

            const handleNewMessage = (e) => {
                e.preventDefault();
                
                const palabrasProhibidas = ['idiota', 'tonto', 'est√∫pido', 'estupido', 'basura', 'mierda', 'hate', 'odio'];
                let textoLimpio = newMessage.toLowerCase();
                
                for (let palabra of palabrasProhibidas) {
                    if (textoLimpio.includes(palabra)) {
                        alert('Mensaje contiene contenido no permitido. Mantengamos el ambiente positivo üí™');
                        return;
                    }
                }

                if (newMessage.trim().length < 3) {
                    alert('Mensaje muy corto');
                    return;
                }

                const mensaje = {
                    id: Date.now(),
                    texto: newMessage,
                    fecha: new Date().toISOString(),
                    usuario: 'An√≥nimo'
                };

                updateData({
                    mensajes: [mensaje, ...data.mensajes].slice(0, 50)
                });

                setNewMessage('');
            };

            const renderScene = () => {
                switch(data.currentLocation) {
                    case 'oficina': return <OficinaScene />;
                    case 'gimnasio': return <GimnasioScene />;
                    case 'casa': return <CasaScene sleeping={data.isAutoSleeping} />;
                    case 'reunion': return <ReunionScene />;
                    case 'mall': return <MallScene />;
                    case 'aeropuerto': return <AeropuertoScene />;
                    case 'restaurante': return <RestauranteScene />;
                    default: return <OficinaScene />;
                }
            };

            const currentLocation = LOCATIONS[data.currentLocation];

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
                    {/* Header */}
                    <div className="bg-black/50 backdrop-blur-md border-b border-cyan-500/30 p-4 sticky top-0 z-50">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold bg-gradient-to-r from-cyan-400 to-orange-500 bg-clip-text text-transparent">
                                    ‚ö° EL RETO DUBAI 100K - LIVE
                                </h1>
                                <p className="text-xs text-cyan-400/70">Sincronizado en tiempo real</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right">
                                    <div className="text-xs text-gray-400">D√≠a #{getDaysElapsed()}</div>
                                    <div className="text-xs text-orange-400">üëÅÔ∏è {visitantes.toLocaleString()}</div>
                                </div>
                                <button onClick={() => setShowAdmin(!showAdmin)} className="text-cyan-400 hover:text-cyan-300 p-2 rounded-lg hover:bg-cyan-500/10 transition-all">üîí</button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 py-6">
                        {/* Stats superiores */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/30 rounded-lg p-4 text-center">
                                <div className="text-sm text-cyan-400 mb-1">üí∞ Ganado</div>
                                <div className="text-2xl font-bold text-cyan-400">{data.totalIngresos.toLocaleString('es-ES')}‚Ç¨</div>
                                <div className="text-xs text-gray-400 mt-1">{progreso.toFixed(1)}% de 100K</div>
                            </div>
                            
                            <div className="bg-gradient-to-br from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-lg p-4 text-center">
                                <div className="text-sm text-orange-400 mb-1">üí∏ Quedan</div>
                                <div className="text-2xl font-bold text-orange-400">{budgetRestante.toLocaleString('es-ES')}‚Ç¨</div>
                                <div className="text-xs text-gray-400 mt-1">{progressoBudget.toFixed(0)}% restante</div>
                            </div>
                            
                            <div className="bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/30 rounded-lg p-4 text-center cursor-pointer hover:from-yellow-500/20 hover:to-orange-500/20 transition-all" onClick={() => setShowLogrosDetail(!showLogrosDetail)}>
                                <div className="text-sm text-yellow-400 mb-1">üèÜ Logros</div>
                                <div className="text-2xl font-bold text-yellow-400">{logrosActuales.length}/3</div>
                                <div className="text-xs text-gray-400 mt-1">Click para ver detalles</div>
                            </div>
                        </div>

                        {/* Detalle de logros */}
                        {showLogrosDetail && (
                            <div className="bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border border-yellow-500/30 rounded-xl p-6 mb-6 animate-slide-in">
                                <h3 className="text-lg font-bold text-yellow-400 mb-4 flex items-center justify-between">
                                    <span>üèÜ Detalle de Logros (Din√°micos)</span>
                                    <button onClick={() => setShowLogrosDetail(false)} className="text-sm text-gray-400 hover:text-white">‚úï</button>
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className={`p-4 rounded-lg border ${logrosActuales.includes('25k') ? 'bg-yellow-500/20 border-yellow-500/50' : 'bg-black/30 border-gray-700'}`}>
                                        <div className="text-3xl mb-2">{logrosActuales.includes('25k') ? 'üèÜ' : 'üîí'}</div>
                                        <div className="font-bold">25.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400 mt-1">
                                            {logrosActuales.includes('25k') ? '¬°Desbloqueado!' : `Faltan ${(25000 - data.totalIngresos).toLocaleString()}‚Ç¨`}
                                        </div>
                                    </div>
                                    <div className={`p-4 rounded-lg border ${logrosActuales.includes('50k') ? 'bg-cyan-500/20 border-cyan-500/50' : 'bg-black/30 border-gray-700'}`}>
                                        <div className="text-3xl mb-2">{logrosActuales.includes('50k') ? 'üíé' : 'üîí'}</div>
                                        <div className="font-bold">50.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400 mt-1">
                                            {logrosActuales.includes('50k') ? '¬°Desbloqueado!' : data.totalIngresos >= 25000 ? `Faltan ${(50000 - data.totalIngresos).toLocaleString()}‚Ç¨` : 'Desbloquea 25K primero'}
                                        </div>
                                    </div>
                                    <div className={`p-4 rounded-lg border ${logrosActuales.includes('75k') ? 'bg-purple-500/20 border-purple-500/50' : 'bg-black/30 border-gray-700'}`}>
                                        <div className="text-3xl mb-2">{logrosActuales.includes('75k') ? 'üëë' : 'üîí'}</div>
                                        <div className="font-bold">75.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400 mt-1">
                                            {logrosActuales.includes('75k') ? '¬°Desbloqueado!' : data.totalIngresos >= 50000 ? `Faltan ${(75000 - data.totalIngresos).toLocaleString()}‚Ç¨` : 'Desbloquea 50K primero'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Barras de progreso */}
                        <div className="mb-6">
                            <div className="mb-4">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-sm font-semibold text-cyan-400">META: 100.000‚Ç¨</span>
                                    <span className="text-xl font-bold text-cyan-400">{data.totalIngresos.toLocaleString('es-ES')}‚Ç¨</span>
                                </div>
                                <div className="h-8 bg-black/50 rounded-full border border-cyan-500/30 overflow-hidden relative">
                                    <div className="h-full bg-gradient-to-r from-cyan-500 via-blue-500 to-cyan-400 transition-all duration-1000" style={{ width: `${Math.min(progreso, 100)}%` }} />
                                    <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-white drop-shadow-lg">
                                        {progreso.toFixed(1)}% completado
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-sm font-semibold text-orange-400">PRESUPUESTO RESTANTE</span>
                                    <span className={`text-xl font-bold ${budgetRestante < 3000 ? 'text-red-500 animate-pulse' : 'text-orange-400'}`}>
                                        {budgetRestante.toLocaleString('es-ES')}‚Ç¨
                                    </span>
                                </div>
                                <div className="h-6 bg-black/50 rounded-full border border-orange-500/30 overflow-hidden relative">
                                    <div className={`h-full transition-all duration-1000 ${budgetRestante < 3000 ? 'bg-gradient-to-r from-red-600 to-red-500' : 'bg-gradient-to-r from-orange-600 to-orange-400'}`} style={{ width: `${Math.max(progressoBudget, 0)}%` }} />
                                    <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-white drop-shadow-lg">
                                        {Math.max(progressoBudget, 0).toFixed(0)}%
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Ubicaci√≥n actual */}
                        <div className={`bg-gradient-to-br ${currentLocation.color} p-1 rounded-xl mb-6 animate-pulse-glow`}>
                            <div className="bg-slate-900/90 backdrop-blur-sm rounded-lg p-6">
                                <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-4">
                                    <div>
                                        <div className="text-sm text-gray-400 mb-1">üìç Marcos est√° ahora en:</div>
                                        <div className="text-3xl font-bold flex items-center gap-3">
                                            <span>{currentLocation.icon}</span>
                                            <span>{currentLocation.name}</span>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-sm text-gray-400">‚è±Ô∏è Hace</div>
                                        <div className="text-2xl font-bold text-cyan-400">{getTimeInLocation()}</div>
                                    </div>
                                </div>
                                <div className="bg-black/30 rounded-lg p-3 border border-white/10">
                                    <div className="text-sm text-gray-400 mb-1">üí¨ Actividad:</div>
                                    <div className="text-lg font-semibold">{data.currentActivity}</div>
                                </div>
                            </div>
                        </div>

                        {/* Escena Sims */}
                        <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm border-2 border-cyan-500/30 rounded-xl p-6 mb-6">
                            <div className="relative w-full min-h-[400px] flex items-center justify-center">
                                {renderScene()}
                            </div>
                        </div>

                        {/* √öltimas actualizaciones con edici√≥n */}
                        <div className="bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/30 rounded-xl p-6 mb-6">
                            <h3 className="text-lg font-bold text-cyan-400 mb-4">üìä √öltimas Actualizaciones</h3>
                            <div className="space-y-3 max-h-96 overflow-y-auto">
                                {data.actualizaciones.length === 0 ? (
                                    <p className="text-center text-gray-500 py-8">A√∫n no hay actualizaciones</p>
                                ) : (
                                    data.actualizaciones.slice(0, 10).map((act) => (
                                        <div key={act.id} className="bg-black/30 rounded-lg p-3 border border-cyan-500/20">
                                            <div className="flex justify-between items-start mb-1">
                                                <span className={`font-bold ${act.tipo === 'ingreso' ? 'text-green-400' : 'text-red-400'}`}>
                                                    {act.tipo === 'ingreso' ? '+' : '-'}{act.monto.toLocaleString('es-ES')}‚Ç¨
                                                </span>
                                                <div className="flex gap-2">
                                                    <span className="text-xs text-gray-500">
                                                        {new Date(act.fecha).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                                                    </span>
                                                    {isAuthenticated && (
                                                        <>
                                                            <button onClick={() => handleEditMovement(act)} className="text-xs text-blue-400 hover:text-blue-300">‚úèÔ∏è</button>
                                                            <button onClick={() => handleDeleteMovement(act.id)} className="text-xs text-red-400 hover:text-red-300">üóëÔ∏è</button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="text-xs text-gray-400">
                                                {act.categoria === 'asesoria' ? 'üíº Asesoramiento' : 
                                                 act.categoria === 'realEstate' ? 'üè¢ Real Estate' : 
                                                 act.categoria === 'inversiones' ? 'üìä Inversiones' : 'üí∏ Gastos'}
                                            </div>
                                            {act.nota && <div className="text-xs text-gray-300 mt-1">{act.nota}</div>}
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Muro de mensajes */}
                        <div className="bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-xl p-6 mb-6">
                            <h3 className="text-lg font-bold text-purple-400 mb-4">üí¨ Mensajes de √Ånimo ({data.mensajes.length})</h3>
                            
                            <form onSubmit={handleNewMessage} className="mb-4">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={newMessage}
                                        onChange={(e) => setNewMessage(e.target.value)}
                                        placeholder="Deja un mensaje de √°nimo... üí™"
                                        maxLength={150}
                                        className="flex-1 bg-black/50 border border-purple-500/30 rounded px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-purple-400"
                                    />
                                    <button type="submit" className="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 px-4 py-2 rounded font-semibold text-sm transition-all">
                                        Enviar
                                    </button>
                                </div>
                            </form>

                            <div className="space-y-2 max-h-64 overflow-y-auto">
                                {data.mensajes.length === 0 ? (
                                    <p className="text-center text-gray-500 py-8">S√© el primero en dejar un mensaje üí¨</p>
                                ) : (
                                    data.mensajes.slice(0, 10).map((msg) => (
                                        <div key={msg.id} className="bg-black/30 rounded-lg p-3 border border-purple-500/20">
                                            <div className="flex justify-between items-start mb-1">
                                                <span className="text-xs font-semibold text-purple-400">{msg.usuario}</span>
                                                <span className="text-xs text-gray-500">
                                                    {new Date(msg.fecha).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}
                                                </span>
                                            </div>
                                            <p className="text-sm text-gray-300">{msg.texto}</p>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        <div className="text-center text-xs text-gray-500">
                            <p>El Reto Dubai 100K - S√≠gueme en Instagram</p>
                            <p className="mt-1">Sistema autom√°tico: Durmiendo 23:00-07:00 (hora Dubai)</p>
                            <p className="mt-1 text-cyan-400">‚úÖ Sincronizado en tiempo real con Firebase</p>
                        </div>
                    </div>

                    {/* Panel Admin */}
                    {showAdmin && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="bg-gradient-to-br from-slate-900 to-slate-800 border-2 border-cyan-500/50 rounded-xl max-w-2xl w-full my-8">
                                <div className="p-6 max-h-[90vh] overflow-y-auto">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-xl font-bold text-cyan-400">üéÆ Panel de Control</h2>
                                        <button onClick={() => { setShowAdmin(false); setIsAuthenticated(false); setAdminPassword(''); setEditingMovement(null); }} className="text-gray-400 hover:text-white text-2xl">‚úï</button>
                                    </div>

                                    {!isAuthenticated ? (
                                        <form onSubmit={handleAdminLogin} className="space-y-4">
                                            <div>
                                                <label className="block text-sm text-gray-300 mb-2">Contrase√±a</label>
                                                <input type="password" value={adminPassword} onChange={(e) => setAdminPassword(e.target.value)} className="w-full bg-black/50 border border-cyan-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400" placeholder="Introduce la contrase√±a" />
                                            </div>
                                            <button type="submit" className="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 px-4 py-3 rounded-lg font-semibold transition-all">Entrar</button>
                                        </form>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-lg p-4">
                                                <h3 className="text-lg font-bold text-purple-400 mb-4">üìç Cambiar Ubicaci√≥n</h3>
                                                <form onSubmit={handleActivityUpdate} className="space-y-4">
                                                    <div>
                                                        <label className="block text-sm text-gray-300 mb-2">¬øD√≥nde est√°s ahora?</label>
                                                        <select value={activityForm.location} onChange={(e) => setActivityForm({...activityForm, location: e.target.value})} className="w-full bg-black/50 border border-purple-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-purple-400">
                                                            {Object.values(LOCATIONS).map(loc => (
                                                                <option key={loc.id} value={loc.id}>{loc.name}</option>
                                                            ))}
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm text-gray-300 mb-2">¬øQu√© est√°s haciendo?</label>
                                                        <input type="text" value={activityForm.activity} onChange={(e) => setActivityForm({...activityForm, activity: e.target.value})} className="w-full bg-black/50 border border-purple-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-purple-400" placeholder="Ej: Llamada con inversor..." maxLength={100} />
                                                    </div>
                                                    <button type="submit" className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 px-4 py-3 rounded-lg font-semibold transition-all">Actualizar Ubicaci√≥n</button>
                                                </form>
                                            </div>

                                            <div className="bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg p-4">
                                                <h3 className="text-lg font-bold text-green-400 mb-4">
                                                    {editingMovement ? '‚úèÔ∏è Editar Movimiento' : 'üí∞ Nuevo Movimiento'}
                                                </h3>
                                                <form onSubmit={editingMovement ? handleSaveEdit : handleFinanceUpdate} className="space-y-4">
                                                    <div>
                                                        <label className="block text-sm text-gray-300 mb-2">Tipo</label>
                                                        <select value={financeForm.tipo} onChange={(e) => setFinanceForm({...financeForm, tipo: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-green-400">
                                                            <option value="ingreso">üí∞ Ingreso</option>
                                                            <option value="gasto">üí∏ Gasto</option>
                                                        </select>
                                                    </div>
                                                    {financeForm.tipo === 'ingreso' && (
                                                        <div>
                                                            <label className="block text-sm text-gray-300 mb-2">Categor√≠a</label>
                                                            <select value={financeForm.categoria} onChange={(e) => setFinanceForm({...financeForm, categoria: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-green-400">
                                                                <option value="asesoria">üíº Asesoramiento</option>
                                                                <option value="realEstate">üè¢ Real Estate</option>
                                                                <option value="inversiones">üìä Inversiones</option>
                                                            </select>
                                                        </div>
                                                    )}
                                                    <div>
                                                        <label className="block text-sm text-gray-300 mb-2">Monto (‚Ç¨)</label>
                                                        <input type="number" value={financeForm.monto} onChange={(e) => setFinanceForm({...financeForm, monto: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-green-400" placeholder="0.00" step="0.01" required />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm text-gray-300 mb-2">Nota</label>
                                                        <textarea value={financeForm.nota} onChange={(e) => setFinanceForm({...financeForm, nota: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white focus:outline-none focus:border-green-400" placeholder="Describe..." rows="3" maxLength={200} />
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button type="submit" className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 px-4 py-3 rounded-lg font-semibold transition-all">
                                                            {editingMovement ? 'Guardar Cambios' : 'Agregar'}
                                                        </button>
                                                        {editingMovement && (
                                                            <button type="button" onClick={() => { setEditingMovement(null); setFinanceForm({ categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: '' }); }} className="px-4 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-semibold transition-all">
                                                                Cancelar
                                                            </button>
                                                        )}
                                                    </div>
                                                </form>
                                            </div>

                                            <div className="bg-black/30 border border-cyan-500/30 rounded-lg p-4">
                                                <h3 className="text-sm font-semibold text-cyan-400 mb-2">üìä Resumen en Tiempo Real</h3>
                                                <div className="grid grid-cols-2 gap-2 text-sm">
                                                    <div>Total Ingresos:</div>
                                                    <div className="text-green-400 font-semibold text-right">{data.totalIngresos.toLocaleString('es-ES')}‚Ç¨</div>
                                                    <div>Total Gastos:</div>
                                                    <div className="text-red-400 font-semibold text-right">{data.totalGastos.toLocaleString('es-ES')}‚Ç¨</div>
                                                    <div>Logros:</div>
                                                    <div className="text-yellow-400 font-semibold text-right">{logrosActuales.length}/3</div>
                                                    <div>Mensajes:</div>
                                                    <div className="text-purple-400 font-semibold text-right">{data.mensajes.length}</div>
                                                    <div>Ubicaci√≥n:</div>
                                                    <div className="text-orange-400 font-semibold text-right">{LOCATIONS[data.currentLocation].name}</div>
                                                    <div>Visitantes:</div>
                                                    <div className="text-cyan-400 font-semibold text-right">{visitantes}</div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<SimsApp />, document.getElementById('root'));
    </script>
</body>
</html>
